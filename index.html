<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xab Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #0f2027, #203a43, #2c5364);
  color: white;
}

.screen {
  display: none;
  padding: 16px;
  padding-bottom: 90px;
}

.screen.active {
  display: block;
}

.balance {
  font-size: 18px;
  margin-bottom: 16px;
}

.task {
  background: #1e2a38;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
}

.task button {
  width: 100%;
  margin-top: 8px;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #2ea6ff;
  color: white;
  font-size: 16px;
}

.task button:disabled {
  background: #555;
}

.nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 70px;
  background: #0b1622;
  display: flex;
  justify-content: space-around;
  align-items: center;
  border-top: 1px solid #223;
}

.nav button {
  background: none;
  border: none;
  color: white;
  font-size: 14px;
  opacity: 0.7;
}

.nav button.active {
  opacity: 1;
  font-weight: bold;
}
</style>
</head>

<body>

<!-- –ó–ê–î–ê–ù–ò–Ø -->
<div id="tasksScreen" class="screen active">
  <h2>–ó–∞–¥–∞–Ω–∏—è</h2>
  <div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> ‚ÇΩ</div>
  <div id="tasks"></div>
</div>

<!-- –ë–û–ù–£–°–´ -->
<div id="bonusScreen" class="screen">
  <h2>–ë–æ–Ω—É—Å—ã</h2>
  <p>üéÅ –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥—É—Ç –±–æ–Ω—É—Å—ã</p>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profileScreen" class="screen">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <p>ID: <span id="uid"></span></p>
</div>

<!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
<div class="nav">
  <button id="btnTasks" class="active" onclick="showScreen('tasks')">–ó–∞–¥–∞–Ω–∏—è</button>
  <button id="btnBonus" onclick="showScreen('bonus')">–ë–æ–Ω—É—Å—ã</button>
  <button id="btnProfile" onclick="showScreen('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

const userId = tg.initDataUnsafe?.user?.id || "guest";
document.getElementById("uid").innerText = userId;

const balanceKey = `balance_${userId}`;
const tasksKey = `tasks_${userId}`;

let balance = parseInt(localStorage.getItem(balanceKey)) || 0;
let completedTasks = JSON.parse(localStorage.getItem(tasksKey)) || [];

const tasks = [
  { id: 1, title: "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª", reward: 10 },
  { id: 2, title: "–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç", reward: 15 },
  { id: 3, title: "–ó–∞–π—Ç–∏ –≤ –±–æ—Ç–∞", reward: 5 }
];

function save() {
  localStorage.setItem(balanceKey, balance);
  localStorage.setItem(tasksKey, JSON.stringify(completedTasks));
}

function renderTasks() {
  document.getElementById("balance").innerText = balance;
  const container = document.getElementById("tasks");
  container.innerHTML = "";

  tasks.forEach(task => {
    const done = completedTasks.includes(task.id);
    const div = document.createElement("div");
    div.className = "task";
    div.innerHTML = `
      <div><b>${task.title}</b></div>
      <div>+${task.reward} ‚ÇΩ</div>
      <button ${done ? "disabled" : ""}>
        ${done ? "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" : "–í—ã–ø–æ–ª–Ω–∏—Ç—å"}
      </button>
    `;

    if (!done) {
      div.querySelector("button").onclick = () => {
        completedTasks.push(task.id);
        balance += task.reward;
        save();
        renderTasks();
      };
    }

    container.appendChild(div);
  });
}

function showScreen(name) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));

  if (name === "tasks") {
    tasksScreen.classList.add("active");
    btnTasks.classList.add("active");
  }
  if (name === "bonus") {
    bonusScreen.classList.add("active");
    btnBonus.classList.add("active");
  }
  if (name === "profile") {
    profileScreen.classList.add("active");
    btnProfile.classList.add("active");
  }
}

renderTasks();
</script>
</body>
</html>
