<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Xab Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
      background: #0b0b0b;
      color: #ffffff;
    }

    .screen {
      display: none;
      padding: 20px;
      padding-bottom: 90px;
    }

    .screen.active {
      display: block;
    }

    .user {
      font-size: 12px;
      color: #888;
      margin-bottom: 10px;
    }

    .balance-card {
      background: linear-gradient(135deg, #2ea6ff, #1c7ed6);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .balance-card h2 {
      margin: 0;
      font-size: 14px;
      opacity: 0.9;
    }

    .balance {
      font-size: 36px;
      font-weight: bold;
      margin-top: 10px;
    }

    .card {
      background: #161616;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 12px;
    }

    button.main {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: #2ea6ff;
      color: #fff;
      font-size: 15px;
      margin-top: 10px;
      transition: transform 0.1s ease, opacity 0.1s ease;
    }

    button.main:active {
      transform: scale(0.97);
      opacity: 0.9;
    }

    button.done {
      background: #2a2a2a;
      color: #777;
    }

    .bottom-menu {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: #111;
      display: flex;
      border-top: 1px solid #222;
    }

    .bottom-menu button {
      flex: 1;
      background: none;
      border: none;
      color: #777;
      font-size: 13px;
    }

    .bottom-menu button.active {
      color: #2ea6ff;
      font-weight: 600;
    }
  </style>
</head>

<body>

  <!-- HOME -->
  <div id="home" class="screen active">
    <div class="user" id="userInfo"></div>

    <div class="balance-card">
      <h2>üí∞ –ë–∞–ª–∞–Ω—Å</h2>
      <div class="balance" id="balance">0</div>
    </div>
  </div>

  <!-- TASKS -->
  <div id="tasks" class="screen">
    <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>

    <!-- TASK 1 -->
    <div class="card">
      <div>üîπ –ü—Ä–æ—Å—Ç–æ–µ –∑–∞–¥–∞–Ω–∏–µ</div>
      <div>–ù–∞–≥—Ä–∞–¥–∞: +5</div>
      <button id="taskBtn1" class="main" onclick="completeTask(1,5)">
        –í—ã–ø–æ–ª–Ω–∏—Ç—å
      </button>
    </div>

    <!-- TASK 2 -->
    <div class="card">
      <div>üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</div>
      <div>–ù–∞–≥—Ä–∞–¥–∞: +10</div>

      <button class="main" onclick="openChannel()">
        –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª
      </button>

      <button id="taskBtn2" class="main" onclick="checkSubscribe()">
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
      </button>
    </div>
  </div>

  <!-- PROFILE -->
  <div id="profile" class="screen">
    <h2>üíº –ü—Ä–æ—Ñ–∏–ª—å</h2>
    <p>ID: <span id="uid"></span></p>
  </div>

  <!-- BOTTOM MENU -->
  <div class="bottom-menu">
    <button id="btn-home" class="active" onclick="showScreen('home')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
    <button id="btn-tasks" onclick="showScreen('tasks')">üìã –ó–∞–¥–∞–Ω–∏—è</button>
    <button id="btn-profile" onclick="showScreen('profile')">üíº –ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>

  <script>
    const tg = Telegram.WebApp;
    tg.ready();
    tg.expand();

    const user = tg.initDataUnsafe?.user;
    if (!user) {
      alert("–û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram");
    }

    const userId = user.id;
    document.getElementById("uid").innerText = userId;
    document.getElementById("userInfo").innerText = "User ID: " + userId;

    const balanceKey = "balance_" + userId;
    let balance = parseInt(localStorage.getItem(balanceKey)) || 0;

    function updateBalance() {
      document.getElementById("balance").innerText = balance;
      localStorage.setItem(balanceKey, balance);
    }

    function completeTask(taskId, reward) {
      const taskKey = "task_" + taskId + "_" + userId;
      if (localStorage.getItem(taskKey)) return;

      balance += reward;
      localStorage.setItem(taskKey, "done");
      updateBalance();
      updateTaskUI(taskId);
      tg.HapticFeedback.impactOccurred("medium");
    }

    const CHANNEL_URL = "https://t.me/Xabarov_crypto"; // ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ú–ï–ù–ò

    function openChannel() {
      tg.openTelegramLink(CHANNEL_URL);
    }

    function checkSubscribe() {
      const taskId = 2;
      const reward = 10;
      const taskKey = "task_" + taskId + "_" + userId;

      if (localStorage.getItem(taskKey)) {
        tg.showAlert("–ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ");
        return;
      }

      balance += reward;
      localStorage.setItem(taskKey, "done");
      updateBalance();
      updateTaskUI(taskId);

      tg.showAlert("–ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞—Å—á–∏—Ç–∞–Ω–∞! +" + reward);
    }

    function updateTaskUI(taskId) {
      const taskKey = "task_" + taskId + "_" + userId;
      const btn = document.getElementById("taskBtn" + taskId);

      if (btn && localStorage.getItem(taskKey)) {
        btn.innerText = "‚úî –í—ã–ø–æ–ª–Ω–µ–Ω–æ";
        btn.disabled = true;
        btn.classList.add("done");
      }
    }

    function showScreen(name) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.querySelectorAll(".bottom-menu button").forEach(b => b.classList.remove("active"));

      document.getElementById(name).classList.add("active");
      document.getElementById("btn-" + name).classList.add("active");
    }

    updateBalance();
    updateTaskUI(1);
    updateTaskUI(2);
  </script>

</body>
</html>
